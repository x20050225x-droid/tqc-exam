<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TQC è³‡æ–™åº«è¨­è¨ˆèˆ‡æ‡‰ç”¨ - å®Œæ•´æ¸¬é©—ç³»çµ±</title>
    <style>
        body { font-family: "Microsoft JhengHei", Arial, sans-serif; background-color: #f4f4f4; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); position: relative; }
        h1 { text-align: center; color: #333; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        
        /* æ­¡è¿/é¸å–®ç•«é¢ */
        .menu-card { text-align: center; padding: 20px; }
        .mode-btn { display: block; width: 100%; max-width: 400px; margin: 15px auto; padding: 15px; font-size: 18px; border: none; border-radius: 8px; cursor: pointer; transition: 0.3s; text-align: left; position: relative; }
        .mode-btn div { font-size: 0.85em; opacity: 0.9; margin-top: 5px; font-weight: normal; }
        .mode-btn span { font-weight: bold; font-size: 1.1em; }

        .btn-normal { background-color: #28a745; color: white; }
        .btn-normal:hover { background-color: #218838; }
        
        .btn-weighted { background-color: #17a2b8; color: white; }
        .btn-weighted:hover { background-color: #138496; }

        .btn-weakness { background-color: #fd7e14; color: white; border-left: 8px solid #c9620b; }
        .btn-weakness:hover { background-color: #e36d0d; }

        .btn-reset { background-color: #6c757d; color: white; margin-top: 30px; font-size: 14px; padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; }

        /* è¨­å®šå€å¡Š */
        .settings-box { background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; max-width: 400px; margin: 20px auto; text-align: left; }
        .settings-title { font-weight: bold; margin-bottom: 10px; color: #495057; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
        .radio-group label { display: inline-block; margin-right: 15px; cursor: pointer; }

        /* æ¸¬é©—å€ */
        .header-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .quit-btn { background: #dc3545; color: white; border: none; padding: 5px 12px; border-radius: 4px; cursor: pointer; font-size: 0.9em; }
        .quit-btn:hover { background: #c82333; }

        .question-card { border: 1px solid #ddd; padding: 15px; margin-bottom: 20px; border-radius: 5px; background-color: #fafafa; }
        .question-title { font-size: 1.2em; font-weight: bold; margin-bottom: 15px; color: #2c3e50; }
        
        /* é¸é …æ¨£å¼ */
        .options label { display: block; margin: 8px 0; cursor: pointer; padding: 12px; border-radius: 5px; border: 1px solid #eee; background: white; transition: 0.2s; position: relative; }
        .options label:hover { background-color: #e9ecef; border-color: #adb5bd; }
        /* è¢«é¸ä¸­çš„æ¨£å¼ */
        .options input:checked + span { font-weight: bold; color: #0056b3; }
        /* é–å®šå¾Œçš„æ¨£å¼ */
        .options input:disabled + span { color: #666; }

        /* æŒ‰éˆ•å€ */
        .nav-buttons { display: flex; justify-content: space-between; margin-top: 15px; }
        .btn { background-color: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; flex: 1; margin: 0 5px; }
        .btn:hover { background-color: #0056b3; }
        
        .btn-prev { background-color: #6c757d; max-width: 120px; }
        .btn-prev:hover { background-color: #5a6268; }
        
        /* çµæœè¨Šæ¯ */
        .result-msg { margin-top: 10px; font-weight: bold; padding: 10px; border-radius: 5px; text-align: center; }
        .correct { background-color: #d4edda; color: #155724; }
        .wrong { background-color: #f8d7da; color: #721c24; }
        
        /* éŒ¯é¡Œåˆ†æå€ */
        .analysis-item { border-left: 5px solid #dc3545; background: #fff5f5; padding: 15px; margin-bottom: 15px; border-radius: 4px; text-align: left; }
        .analysis-q { font-weight: bold; color: #333; }
        .weight-badge { background: #ffc107; color: #333; padding: 2px 6px; border-radius: 10px; font-size: 0.8em; margin-left: 5px; }

        .hidden { display: none; }
        .invisible { visibility: hidden; }
    </style>
</head>
<body>

<div class="container">
    <h1>TQC è³‡æ–™åº«è¨­è¨ˆèˆ‡æ‡‰ç”¨ - æ™ºæ…§æ¸¬é©—ç³»çµ±</h1>

    <div id="start-screen" class="menu-card">
        
        <div class="settings-box">
            <div class="settings-title">âš™ï¸ ä½œç­”è¨­å®š</div>
            <div class="radio-group">
                <label>
                    <input type="radio" name="submitMode" value="confirm" checked> ç¢ºèªå¾Œé€å‡º (æª¢æŸ¥ç”¨)
                </label>
                <label>
                    <input type="radio" name="submitMode" value="instant"> é»æ“Šå³é€å‡º (ç§’æ®ºç”¨)
                </label>
            </div>
            <div style="margin-top: 10px; font-size: 0.85em; color: #666;">
                * ç§’æ®ºæ¨¡å¼ä¸‹ï¼Œç­”é¡Œå¾Œå°‡è‡ªå‹•åœç•™ 1 ç§’ä¸¦è·³è½‰ä¸‹ä¸€é¡Œ
            </div>
        </div>

        <button class="mode-btn btn-normal" onclick="startExam('normal')">
            <span>ğŸ² éš¨æ©Ÿæ¸¬é©— (40é¡Œ)</span>
            <div>å¾å®Œæ•´é¡Œåº«ä¸­éš¨æ©ŸæŠ½é¸ï¼Œé©åˆæ—¥å¸¸ç·´ç¿’</div>
        </button>
        
        <button class="mode-btn btn-weighted" onclick="startExam('weighted')">
            <span>âš–ï¸ åŠ æ¬Šéš¨æ©Ÿ (40é¡Œ)</span>
            <div>å¸¸éŒ¯é¡Œç›®å‡ºç¾æ©Ÿç‡è¼ƒé«˜ï¼Œå…¼é¡§è¤‡ç¿’èˆ‡æ–°é¡Œ</div>
        </button>

        <button class="mode-btn btn-weakness" onclick="startExam('top20')">
            <span>ğŸ”¥ éŒ¯é¡Œç‰¹è¨“ (Top 20)</span>
            <div>ç›´æ¥é–å®šéŒ¯èª¤æ¬Šé‡æœ€é«˜çš„ 20 é¡Œé€²è¡Œç‰¹è¨“</div>
        </button>

        <div style="margin-top: 20px; font-size: 0.9em; color: #666;">
            éŒ¯é¡Œæ¬Šé‡è³‡æ–™åº«ï¼š<span id="stored-count">0</span> ç­† <br>
            <span id="total-q-count" style="font-size: 0.85em; color: #888;">(è¼‰å…¥ä¸­...)</span>
        </div>
        
        <button class="mode-btn btn-reset" onclick="resetWeights()">é‡ç½®æ‰€æœ‰ç´€éŒ„</button>
    </div>
    
    <div id="quiz-area" class="hidden">
        <div class="header-bar">
            <div>
                <span id="current-mode-text" style="color: #007bff; font-weight: bold;"></span> | 
                é€²åº¦: <span id="current-q">1</span> / <span id="total-exam-q">40</span>
            </div>
            <button class="quit-btn" onclick="quitExam()">â†© è¿”å›é¸å–®</button>
        </div>
        
        <div id="question-container">
            </div>

        <div class="nav-buttons">
            <button id="prev-btn" class="btn btn-prev hidden" onclick="prevQuestion()">â¬… ä¸Šä¸€é¡Œ</button>
            <button id="submit-btn" class="btn" onclick="checkAnswer()">é€å‡ºç­”æ¡ˆ</button>
            <button id="next-btn" class="btn hidden" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ â¡</button>
        </div>
    </div>

    <div id="final-result" class="hidden">
        <div style="text-align: center; margin-bottom: 30px;">
            <h2>æ¸¬é©—çµæŸ</h2>
            <div style="font-size: 1.5em; color: #555;">ç­”å°é¡Œæ•¸ï¼š<span id="correct-count"></span> / <span id="total-count"></span></div>
            <div style="font-size: 2.5em; font-weight: bold; color: #007bff; margin-top: 10px;">
                ç¸½åˆ†ï¼š<span id="final-score"></span>
            </div>
            <p style="font-size: 0.9em; color: #888;">(æ¯é¡Œ 2.5 åˆ†)</p>
        </div>

        <div id="wrong-answer-analysis">
            <h3 style="border-bottom: 2px solid #ddd; padding-bottom: 10px;">æœ¬æ¬¡éŒ¯é¡Œåˆ—è¡¨</h3>
            <div id="analysis-list">
                </div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button class="btn" onclick="goHome()">è¿”å›ä¸»é¸å–®</button>
        </div>
    </div>
</div>

<script src="questions_part1.js"></script>
<script src="questions_part2.js"></script>
<script src="questions_part3.js"></script>
<script src="questions_part4.js"></script>

<script>
    // --- 1. åˆä½µé¡Œç›®è³‡æ–™ ---
    let questions = [];
    if (typeof questions_part1 !== 'undefined') questions = questions.concat(questions_part1);
    if (typeof questions_part2 !== 'undefined') questions = questions.concat(questions_part2);
    if (typeof questions_part3 !== 'undefined') questions = questions.concat(questions_part3);
    if (typeof questions_part4 !== 'undefined') questions = questions.concat(questions_part4);

    // é¡¯ç¤ºç¸½é¡Œæ•¸
    const totalCountEl = document.getElementById('total-q-count');
    if (questions.length > 0) {
        totalCountEl.innerText = `(ç›®å‰é¡Œåº«ç¸½æ•¸: ${questions.length} é¡Œ)`;
    } else {
        totalCountEl.innerText = "(éŒ¯èª¤ï¼šæœªè¼‰å…¥ä»»ä½•é¡Œç›®ï¼Œè«‹æª¢æŸ¥ .js æª”æ¡ˆ)";
        totalCountEl.style.color = "red";
    }

    // --- å…¨åŸŸè®Šæ•¸ ---
    const QUESTIONS_PER_EXAM = 40; 
    let examQuestions = []; 
    let currentQuestionIndex = 0;
    let correctCount = 0; // ç­”å°é¡Œæ•¸
    let userWrongAnswers = []; 
    let submitMode = 'confirm';
    let answerHistory = {}; 

    // --- åˆå§‹åŒ–èˆ‡å·¥å…·å‡½æ•¸ ---
    function getStoredWeights() {
        const stored = localStorage.getItem('tqc_db_exam_weights'); // ä½¿ç”¨ä¸åŒçš„ key é¿å…èˆ‡ç¶²è·¯ç®¡ç†æ··æ·†
        return stored ? JSON.parse(stored) : {};
    }

    function saveStoredWeights(weights) {
        localStorage.setItem('tqc_db_exam_weights', JSON.stringify(weights));
        updateUIStats();
    }

    function updateUIStats() {
        const weights = getStoredWeights();
        const count = Object.keys(weights).length;
        let weightedCount = 0;
        for(let k in weights) { if(weights[k] > 1) weightedCount++; }
        
        const displayEl = document.getElementById('stored-count');
        if(displayEl) displayEl.innerText = weightedCount > 0 ? `${count} (å…¶ä¸­ ${weightedCount} é¡Œæœ‰åŠ æ¬Š)` : '0';
    }
    
    updateUIStats();

    // --- æ ¸å¿ƒåŠŸèƒ½: é–‹å§‹æ¸¬é©— ---
    function startExam(mode) {
        if (questions.length === 0) {
            alert("éŒ¯èª¤ï¼šé¡Œåº«ç‚ºç©ºï¼Œç„¡æ³•é–‹å§‹æ¸¬é©—ï¼è«‹ç¢ºèª questions_partX.js æª”æ¡ˆæ˜¯å¦å­˜åœ¨ã€‚");
            return;
        }

        const radioInstant = document.querySelector('input[name="submitMode"][value="instant"]');
        submitMode = radioInstant.checked ? 'instant' : 'confirm';

        correctCount = 0;
        currentQuestionIndex = 0;
        userWrongAnswers = [];
        answerHistory = {}; // é‡ç½®æ­·å²ç´€éŒ„
        
        // æ·±æ‹·è²ä¸€ä»½é¡Œç›®æ± ï¼Œé¿å…æ±™æŸ“åŸå§‹è³‡æ–™
        let pool = JSON.parse(JSON.stringify(questions));
        const weights = getStoredWeights();

        // --- é¸é¡Œé‚è¼¯ ---
        if (mode === 'top20') {
            let wrongPool = pool.filter(q => (weights[q.id] || 1) > 1);
            if (wrongPool.length === 0) {
                alert("å¤ªæ£’äº†ï¼ç›®å‰æ²’æœ‰éŒ¯é¡Œç´€éŒ„ã€‚\nç³»çµ±å°‡è‡ªå‹•åˆ‡æ›ç‚ºéš¨æ©Ÿæ¨¡å¼ã€‚");
                startExam('normal');
                return;
            }
            // æ¬Šé‡é«˜çš„æ’å‰é¢
            wrongPool.sort((a, b) => (weights[b.id] || 1) - (weights[a.id] || 1));
            // å–å‰20
            examQuestions = wrongPool.slice(0, 20);
            
            // é¸æ“‡æ€§ï¼šTop 20 å…§éƒ¨å†éš¨æ©Ÿä¸€ä¸‹é †åºï¼Œé¿å…èƒŒé †åº
            examQuestions.sort(() => Math.random() - 0.5);

        } else if (mode === 'weighted') {
            examQuestions = [];
            const targetCount = Math.min(QUESTIONS_PER_EXAM, pool.length);
            for (let i = 0; i < targetCount; i++) {
                let totalWeight = 0;
                pool.forEach(q => {
                    let w = weights[q.id] || 1; 
                    q._tempWeight = w;
                    totalWeight += w;
                });
                let randomVal = Math.random() * totalWeight;
                let selectedIndex = -1;
                for (let j = 0; j < pool.length; j++) {
                    randomVal -= pool[j]._tempWeight;
                    if (randomVal <= 0) { selectedIndex = j; break; }
                }
                if (selectedIndex === -1) selectedIndex = pool.length - 1;
                examQuestions.push(pool[selectedIndex]);
                pool.splice(selectedIndex, 1);
            }
        } else {
            // ä¸€èˆ¬éš¨æ©Ÿ (Fisher-Yates Shuffle)
            for (let i = pool.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [pool[i], pool[j]] = [pool[j], pool[i]];
            }
            examQuestions = pool.slice(0, QUESTIONS_PER_EXAM);
        }

        // åˆ‡æ›ç•«é¢
        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('quiz-area').classList.remove('hidden');
        
        let modeName = (mode === 'weighted') ? "åŠ æ¬Š" : (mode === 'top20' ? "éŒ¯é¡Œç‰¹è¨“" : "ä¸€èˆ¬");
        document.getElementById('current-mode-text').innerText = modeName;
        document.getElementById('total-exam-q').innerText = examQuestions.length;
        
        renderQuestion();
    }

    // --- æ¸²æŸ“é¡Œç›® ---
    function renderQuestion() {
        const q = examQuestions[currentQuestionIndex];
        const container = document.getElementById('question-container');
        document.getElementById('current-q').innerText = currentQuestionIndex + 1;
        
        // æª¢æŸ¥é€™ä¸€é¡Œæ˜¯å¦å·²ç¶“ä½œç­”é
        const history = answerHistory[currentQuestionIndex];
        const isReviewed = (history && history.checked); // æ˜¯å¦å·²ä½œç­”ä¸¦æª¢æŸ¥é

        const weights = getStoredWeights();
        const currentWeight = weights[q.id] || 1;
        
        let inputType = q.type; 
        let optionsHtml = '';
        const keys = Object.keys(q.options).sort(); 
        
        // ç§’æ®ºæ¨¡å¼æ¢ä»¶ï¼šè¨­å®šç‚ºInstantã€é¡Œç›®æ˜¯å–®é¸ã€ä¸”å°šæœªä½œç­”é
        const isInstant = (submitMode === 'instant' && inputType === 'radio' && !isReviewed);

        keys.forEach(key => {
            let checkedAttr = '';
            let disabledAttr = '';
            let clickAction = isInstant ? `onclick="checkAnswer()"` : '';

            // å¦‚æœå·²ç¶“ä½œç­”éï¼Œé‚„åŸé¸æ“‡ç‹€æ…‹ä¸¦é–å®š
            if (isReviewed) {
                if (history.userAns.includes(key)) {
                    checkedAttr = 'checked';
                }
                disabledAttr = 'disabled';
                clickAction = ''; 
            }

            optionsHtml += `
                <label>
                    <input type="${inputType}" name="option" value="${key}" ${clickAction} ${checkedAttr} ${disabledAttr}>
                    <span>(${key})</span> ${q.options[key]}
                </label>
            `;
        });

        let badgeHtml = currentWeight > 1 ? `<span class="weight-badge" title="éŒ¯èª¤æ¬Šé‡">æ¬Šé‡: ${currentWeight}</span>` : '';

        container.innerHTML = `
            <div class="question-card">
                <div class="question-title">
                    ${q.id}. ${q.text} ${badgeHtml}
                </div>
                <div class="options">
                    ${optionsHtml}
                </div>
                <div id="result-msg" class="result-msg hidden"></div>
            </div>
        `;

        // æŒ‰éˆ•ç‹€æ…‹æ§åˆ¶
        if (isReviewed) {
            // å·²ä½œç­”ç‹€æ…‹ï¼šé¡¯ç¤ºçµæœã€éš±è—é€å‡º
            showResultUI(history.isCorrect, q.answer);
            document.getElementById('submit-btn').classList.add('hidden');
            
            // å°è¦½æŒ‰éˆ•
            const nextBtn = document.getElementById('next-btn');
            if (currentQuestionIndex < examQuestions.length - 1) {
                nextBtn.innerText = "ä¸‹ä¸€é¡Œ â¡";
                nextBtn.onclick = nextQuestion;
                nextBtn.classList.remove('hidden');
            } else {
                 nextBtn.innerText = "æŸ¥çœ‹æˆç¸¾";
                 nextBtn.onclick = showFinalResult;
                 nextBtn.classList.remove('hidden');
            }
        } else {
            // å°šæœªä½œç­”ç‹€æ…‹
            const submitBtn = document.getElementById('submit-btn');
            if (isInstant) {
                submitBtn.classList.add('hidden'); // ç§’æ®ºæ¨¡å¼éš±è—æŒ‰éˆ•
            } else {
                submitBtn.classList.remove('hidden');
            }
            document.getElementById('next-btn').classList.add('hidden');
        }

        // ä¸Šä¸€é¡ŒæŒ‰éˆ•æ§åˆ¶
        const prevBtn = document.getElementById('prev-btn');
        if (currentQuestionIndex > 0) {
            prevBtn.classList.remove('hidden');
        } else {
            prevBtn.classList.add('hidden');
        }
    }

    // --- æª¢æŸ¥ç­”æ¡ˆ ---
    function checkAnswer() {
        const q = examQuestions[currentQuestionIndex];
        const selectedEls = document.querySelectorAll('input[name="option"]:checked');
        
        // é˜²æ­¢é‡è¤‡è§¸ç™¼
        if (answerHistory[currentQuestionIndex] && answerHistory[currentQuestionIndex].checked) return;

        let userAns = [];
        selectedEls.forEach(el => userAns.push(el.value));
        userAns.sort();

        if (userAns.length === 0) {
            if (submitMode !== 'instant') alert("è«‹å…ˆé¸æ“‡ç­”æ¡ˆï¼");
            return;
        }

        const isCorrect = JSON.stringify(userAns) === JSON.stringify(q.answer);
        
        // æ›´æ–°æ¬Šé‡èˆ‡çµ±è¨ˆ
        updateQuestionWeight(q.id, isCorrect);
        if (isCorrect) correctCount++;
        
        // è¨˜éŒ„
        answerHistory[currentQuestionIndex] = {
            userAns: userAns,
            isCorrect: isCorrect,
            checked: true
        };

        if (!isCorrect) {
            userWrongAnswers.push({
                question: q,
                userAns: userAns,
                correctAns: q.answer
            });
        }

        // é¡¯ç¤ºçµæœ
        showResultUI(isCorrect, q.answer);
        
        // é–å®š
        const allInputs = document.querySelectorAll('input[name="option"]');
        allInputs.forEach(input => input.disabled = true);

        // éš±è—é€å‡ºæŒ‰éˆ•
        document.getElementById('submit-btn').classList.add('hidden');

        // è‡ªå‹•è·³è½‰
        setTimeout(() => {
            // å¦‚æœä½¿ç”¨è€…é‚„åœ¨çœ‹é€™é¡Œ(æ²’æœ‰æ‰‹å‹•æŒ‰ä¸Šä¸€é¡Œ)ï¼Œä¸”ä¸æ˜¯æœ€å¾Œä¸€é¡Œï¼Œå‰‡è·³ä¸‹ä¸€é¡Œ
            if (currentQuestionIndex < examQuestions.length - 1) {
                nextQuestion();
            } else {
                // æœ€å¾Œä¸€é¡Œï¼Œç›´æ¥é¡¯ç¤ºæŒ‰éˆ•è®“ä½¿ç”¨è€…æ±ºå®šä½•æ™‚çµç®—
                const nextBtn = document.getElementById('next-btn');
                nextBtn.innerText = "æŸ¥çœ‹æˆç¸¾";
                nextBtn.onclick = showFinalResult;
                nextBtn.classList.remove('hidden');
            }
        }, 500); 
    }

    function showResultUI(isCorrect, correctAns) {
        const resultMsg = document.getElementById('result-msg');
        resultMsg.classList.remove('hidden');
        if (isCorrect) {
            resultMsg.innerHTML = "ğŸ‰ ç­”å°äº†ï¼";
            resultMsg.className = "result-msg correct";
        } else {
            resultMsg.innerHTML = `âŒ ç­”éŒ¯äº†ï¼æ­£ç¢ºç­”æ¡ˆï¼š${correctAns.join('')}`;
            resultMsg.className = "result-msg wrong";
        }
    }

    function updateQuestionWeight(questionId, isCorrect) {
        let weights = getStoredWeights();
        let currentW = weights[questionId] || 1;
        if (isCorrect) {
            currentW = Math.max(1, currentW - 1);
        } else {
            currentW = currentW + 1;
        }
        weights[questionId] = currentW;
        saveStoredWeights(weights);
    }

    function prevQuestion() {
        if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            renderQuestion();
        }
    }

    function nextQuestion() {
        if (currentQuestionIndex < examQuestions.length - 1) {
            currentQuestionIndex++;
            renderQuestion();
        } else {
            showFinalResult();
        }
    }

    function quitExam() {
        if(confirm("æ¸¬é©—å°šæœªçµæŸï¼Œç¢ºå®šè¦è¿”å›é¸å–®å—ï¼Ÿ")) {
            goHome();
        }
    }

    function goHome() {
        document.getElementById('quiz-area').classList.add('hidden');
        document.getElementById('final-result').classList.add('hidden');
        document.getElementById('start-screen').classList.remove('hidden');
        updateUIStats();
    }

    function showFinalResult() {
        document.getElementById('quiz-area').classList.add('hidden');
        document.getElementById('final-result').classList.remove('hidden');
        
        // åˆ†æ•¸è¨ˆç®—ï¼šTQC 40é¡Œæ»¿åˆ†100ï¼Œæ¯é¡Œ 2.5 åˆ†
        let finalScore = correctCount * 2.5;
        
        document.getElementById('correct-count').innerText = correctCount;
        document.getElementById('total-count').innerText = examQuestions.length;
        document.getElementById('final-score').innerText = finalScore;

        const analysisList = document.getElementById('analysis-list');
        analysisList.innerHTML = ""; 

        if (userWrongAnswers.length === 0) {
            analysisList.innerHTML = "<div style='text-align:center; color:#28a745; padding:20px;'>âœ¨ å®Œç¾ï¼æœ¬æ¬¡æ²’æœ‰ç­”éŒ¯ä»»ä½•é¡Œç›®ï¼</div>";
        } else {
            const weights = getStoredWeights();
            userWrongAnswers.forEach((item, idx) => {
                const q = item.question;
                const newWeight = weights[q.id] || 1;
                analysisList.innerHTML += `
                    <div class="analysis-item">
                        <div class="analysis-q">
                            ${idx + 1}. [${q.id}] ${q.text} 
                            <span class="weight-badge">æ¬Šé‡: ${newWeight}</span>
                        </div>
                        <div style="margin-top:5px; color:#666;">
                            ä½ çš„ç­”æ¡ˆ: <b style="color:#dc3545">${item.userAns.join('')}</b> â” 
                            æ­£ç¢ºç­”æ¡ˆ: <b style="color:#28a745">${item.correctAns.join('')}</b>
                        </div>
                    </div>
                `;
            });
        }
    }

    function resetWeights() {
        if(confirm("ç¢ºå®šè¦åˆªé™¤æ‰€æœ‰éŒ¯é¡Œæ¬Šé‡ç´€éŒ„å—ï¼Ÿ")) {
            localStorage.removeItem('tqc_db_exam_weights');
            updateUIStats();
            alert("å·²é‡ç½®å®Œç•¢ï¼");
        }
    }
</script>

</body>
</html>